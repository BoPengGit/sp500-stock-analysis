const sqlite3 = require('sqlite3').verbose();
const path = require('path');

const DB_PATH = path.join(__dirname, 'data', 'stocks.db');

// Frontend data provided by user (parsed from the table)
const frontendData = `NVDA	4580.89	262.85	27.73	114.20
META	1567.04	29.73	8.27	21.94
MU	265.52	30.35	7.10	48.85
COIN	79.10	11.67	10.31	111.17
AVGO	1641.70	21.63	27.40	43.99
LRCX	200.15	11.61	10.22	23.68
UBER	191.14	16.48	3.85	17.96
HOOD	115.38	44.00	27.44	58.23
WDC	56.59	9.61	4.71	50.70
PLTR	406.45	73.11	104.32	28.79
GOOG	3375.32	90.02	8.74	13.87
TTD	21.02	33.80	7.53	25.63
ANET	169.24	10.27	20.03	19.50
APH	170.25	8.74	8.12	21.25
KKR	108.09	7.56	6.44	51.09
PGR	127.39	5.25	1.50	21.36
MSFT	3692.87	23.91	12.57	14.93
NEM	91.00	5.31	4.28	57.60
QCOM	183.02	10.58	4.13	13.66
O	52.32	5.95	9.34	29.23
DASH	87.28	9.12	6.91	24.17
FCX	57.16	17.29	2.20	12.10
AMZN	2612.65	46.13	3.78	10.99
CCL	34.96	16.89	1.33	15.88
AMD	379.00	51.60	11.83	13.69
APP	209.51	6.63	37.95	43.44
DOC	12.38	6.93	4.04	23.82
JPM	855.36	7.29	3.08	18.04
SYF	27.76	2.94	1.38	39.38
APA	8.53	6.71	0.88	17.61
BAC	388.49	34.12	2.06	11.94
CMG	41.27	32.75	3.50	14.61
NCLH	8.68	25.55	0.90	10.87
LLY	830.35	3.81	13.97	32.00
CI	70.68	3.02	0.26	26.56
SQ	39.90	21.38	1.66	10.06
SW	18.70	3.82	0.60	86.02
BSX	148.27	5.73	7.66	17.61
ABNB	75.31	11.55	6.31	11.95
IBKR	121.51	3.91	47.18	19.64
STX	59.36	5.00	6.21	38.86
AMCR	19.32	21.73	1.11	10.04
MS	258.04	5.18	2.28	16.83
ACGL	33.43	2.31	1.74	27.35
SLB	54.77	11.07	1.55	9.52
PFE	138.90	111.91	2.21	6.84
FTNT	62.67	7.06	9.56	12.27
FOXA	29.79	3.76	1.81	16.60
C	185.54	12.40	1.10	9.86
PYPL	61.96	13.39	1.89	6.81
AMGN	172.42	2.66	4.79	18.57
NDAQ	50.10	3.43	6.13	22.03
NFLX	467.66	4.35	10.78	15.65
ICE	85.38	3.49	7.11	18.76
BX	175.18	2.96	21.38	52.91
UNH	293.68	9.35	0.67	7.71
WFC	279.77	12.46	2.28	8.72
OKE	42.87	2.19	1.36	22.41
CARR	48.44	4.30	2.20	18.65
WELL	130.57	3.31	13.31	21.23
PANW	142.01	5.05	15.40	14.87
DXCM	21.52	10.45	4.76	11.34
BK	76.46	3.28	1.89	17.05
ORCL	671.20	18.33	11.37	8.38
AAPL	3967.02	45.14	9.53	6.43
CRWD	133.72	2.40	30.80	29.39
DECK	12.26	2.91	2.34	16.28
WDAY	60.12	3.69	6.73	16.94
FSLR	28.72	2.51	5.69	26.75
V	649.61	4.18	16.24	11.34
RTX	236.91	2.50	2.76	17.15
CPRT	39.21	7.48	8.44	9.68
COF	138.48	3.95	2.19	9.00
ISRG	200.05	2.71	20.81	17.24
FI	34.26	14.13	1.62	7.14
ADBE	136.86	4.11	5.90	10.80
F	51.70	71.70	0.27	5.00
HST	12.27	14.67	2.07	7.02
MRK	215.51	7.16	3.36	6.74
BMY	95.05	6.86	1.98	7.32
CRM	229.69	4.85	5.81	8.72
PRU	37.56	1.09	0.67	30.19
DAL	38.45	8.48	0.61	6.19
FANG	41.77	1.56	2.73	32.19
LVS	44.09	5.31	3.60	8.93
PM	238.76	5.48	5.98	7.69
DELL	98.64	5.76	0.97	8.08
NOW	179.27	1.63	14.15	22.44
CSCO	280.93	15.09	4.96	5.30
BKR	47.24	4.87	1.70	9.11
EXPE	30.52	7.61	2.12	6.64
ACN	153.57	4.05	2.20	7.36
KLAC	156.80	1.14	12.52	23.89
GS	246.69	1.83	1.86	17.00
SNPS	73.08	2.64	11.36	15.01
VICI	32.43	8.66	8.15	6.57
WMT	817.93	17.22	1.18	5.07
AXP	257.15	2.29	3.27	10.15
STT	33.05	1.62	1.44	19.64
INTU	180.90	1.70	9.61	15.63
CSGP	28.62	4.05	9.36	11.45
FOX	26.86	1.39	1.81	16.60
ZTS	52.99	5.01	5.64	8.33
UAL	31.54	5.98	0.54	6.23
PFG	18.64	1.37	1.26	18.02
RCL	69.82	1.55	4.00	18.60
GILD	147.46	9.04	5.07	6.04
WRB	28.49	1.60	1.94	12.32
EXPD	18.65	1.67	1.67	13.98
DAY	10.89	2.86	5.75	16.27
KIM	13.91	3.23	6.55	14.22
MOH	8.24	1.69	0.15	19.31
GRMN	38.70	1.14	5.57	20.44
MA	495.65	1.89	15.75	12.23
SPGI	150.32	1.70	10.01	13.69
BRO	26.82	2.56	5.03	12.05
FITB	28.34	9.14	2.21	5.62
MNST	68.09	14.11	8.54	4.94
EXR	28.27	0.87	8.57	27.64
AXON	47.25	1.05	18.47	33.44
HPE	30.92	20.30	0.94	3.50
WYNN	13.12	3.20	1.84	9.13
PTC	21.10	1.20	7.70	19.18
LULU	18.85	2.85	1.73	10.07
INCY	20.81	1.90	4.32	14.76
AON	74.87	1.04	4.40	17.36
ORLY	82.22	6.09	4.71	5.67
GD	93.42	1.21	1.81	12.88
HUM	30.31	1.47	0.24	10.70
GE	324.11	3.77	7.37	9.49
CNC	18.46	10.49	0.10	5.89
TKO	14.99	0.96	3.46	67.43
CME	99.70	2.16	15.59	9.88
CDNS	88.48	1.61	16.97	13.48
USB	73.63	5.54	1.78	5.14
CBRE	45.42	1.15	1.16	11.95
CMCSA	99.66	36.50	0.81	1.78
MCK	105.97	0.50	0.28	16.22
COST	408.94	2.00	1.49	8.17
VTR	33.66	3.27	6.06	9.48
HWM	83.18	2.28	10.43	11.90
CB	115.06	0.99	1.96	12.00
LUV	16.78	7.57	0.61	5.34
ALL	53.50	0.95	0.81	12.24
KDP	35.27	19.61	2.18	3.62
AKAM	12.01	9.14	2.91	4.70
MGM	8.93	3.63	0.52	6.66
EXC	46.69	7.03	1.92	5.99
SBUX	97.27	14.98	2.62	2.79
OMC	14.33	3.03	0.89	6.79
EG	13.68	0.51	0.78	18.06
MCO	87.73	0.66	11.70	19.81
MPWR	45.89	0.74	17.25	21.20
TROW	22.69	1.82	3.15	9.80
JNJ	449.50	4.81	4.88	4.30
BDX	50.97	2.50	2.33	8.23
DIS	199.10	7.25	2.11	2.77
GEN	15.87	9.18	3.55	3.55
TMUS	231.55	6.38	2.70	3.62
INVH	17.17	4.28	6.35	7.67
EW	48.96	2.62	8.32	8.57
VZ	168.78	28.34	1.23	0.61
RF	22.41	28.08	2.21	2.40
XYL	36.84	0.78	4.14	16.27
IVZ	10.40	4.37	1.66	6.13
ETN	145.34	2.53	5.46	7.25
IRM	30.78	1.68	4.64	12.22
XOM	494.34	12.07	1.49	1.36
MMC	88.59	2.13	3.35	7.57
MET	50.64	5.30	0.71	3.29
HCA	115.69	0.95	1.56	8.67
EME	29.07	0.33	1.79	15.76
AMP	42.87	0.43	9.52	18.00
PODD	22.51	0.68	8.93	22.07
TPR	21.58	6.18	3.08	5.09
HIG	36.06	1.07	1.30	8.44
CTAS	74.68	2.20	7.07	7.75
TRV	63.23	0.73	1.31	12.22
COR	69.93	1.04	0.22	9.31
CVS	100.27	3.18	0.25	4.20
RMD	36.86	1.32	7.01	9.84
KO	303.62	21.45	6.37	2.86
SYK	136.15	1.10	5.58	10.23
ROL	28.40	1.51	7.72	10.26
SMCI	23.63	32.83	1.12	0.00
BEN	11.54	8.05	1.34	3.45
TJX	160.95	4.57	2.78	3.95
WM	81.35	1.66	3.28	8.01
TT	96.35	0.78	4.58	12.22
MDT	118.26	4.79	3.46	3.62
AMAT	183.29	6.40	6.41	2.49
SO	100.56	3.77	3.48	5.83
HLT	63.53	1.67	5.41	9.17
TDG	72.40	0.21	8.44	20.52
ARE	9.61	2.94	3.18	7.29
TEL	71.41	1.58	4.18	7.85
ADSK	63.74	0.95	9.66	12.70
CL	63.49	7.43	3.16	3.31
ABBV	387.30	4.57	6.49	3.71
ADP	102.80	1.78	4.92	7.07
CINF	25.73	0.61	2.13	13.22
DG	21.84	3.06	0.52	4.96
VRTX	105.08	1.29	8.96	11.66
LHX	54.38	0.75	2.50	9.82
UHS	14.59	0.57	0.86	10.82
BLK	167.65	0.47	7.33	14.27
TTWO	42.80	5.79	6.88	5.31
ABT	219.94	3.50	5.02	4.59
TSLA	1383.18	101.47	14.46	0.95
ROP	48.12	0.77	6.23	13.94
LEN	31.00	3.66	0.89	3.53
T	176.03	55.63	1.41	-0.08
GLW	73.29	6.29	4.91	4.21
PAYX	40.33	3.51	6.96	5.56
HON	123.21	3.27	3.03	5.05
MAR	78.13	2.47	3.01	5.85
DLTR	22.49	2.93	1.03	4.75
EOG	57.55	6.17	2.55	0.85
MDLZ	73.81	8.70	1.96	1.18
DUK	96.16	4.65	3.04	4.46
YUM	41.39	1.91	5.23	6.68
AWK	25.53	1.14	5.04	10.63
BKNG	159.24	0.27	6.12	11.11
DVN	21.39	8.30	1.27	2.82
TSN	18.69	8.12	0.35	0.81
DD	39.83	5.67	3.19	2.64
SYY	36.45	3.01	0.44	3.20
L	21.23	0.49	1.16	11.69
HD	369.40	2.11	2.24	4.48
CTSH	35.98	4.50	1.72	1.98
HBAN	22.90	27.15	5.00	0.00
MSCI	45.10	0.38	14.76	12.94
FE	26.51	4.66	1.83	4.68
TER	29.28	3.63	10.24	5.36
FICO	41.77	0.25	20.98	15.91
UPS	81.37	7.73	0.91	0.16
LMT	107.27	2.02	1.46	5.14
CSX	65.81	11.27	5.00	0.00
EMR	72.88	3.83	4.05	3.00
FAST	46.89	5.11	5.86	2.71
EBAY	37.88	5.48	3.54	1.69
BAX	9.25	7.40	0.84	2.66
PEP	195.47	7.33	2.12	0.42
EVRG	17.40	2.75	2.96	6.16
FFIV	14.12	0.93	4.57	9.66
KVUE	32.35	43.69	2.16	0.07
EIX	21.95	1.65	1.21	7.72
ERIE	13.16	0.14	3.26	16.10
EFX	25.70	1.23	4.32	7.90
NVR	20.75	0.02	2.01	10.58
NWSA	15.17	6.01	1.78	2.42
MTCH	7.91	3.80	2.28	3.41
CBOE	26.85	0.97	5.82	8.51
REG	12.68	0.90	8.12	9.74
COO	13.99	1.30	3.46	8.41
REGN	67.91	0.69	4.77	8.27
TXT	14.46	1.10	1.02	6.47
DGX	20.06	1.02	1.85	6.70
RSG	64.31	1.00	3.90	7.13
GEV	156.04	2.82	4.14	5.10
IR	30.62	2.04	4.11	5.22
JCI	80.00	3.97	3.39	2.81
EQT	36.18	4.74	4.20	3.00
TRGP	36.94	1.66	2.14	6.45
LH	20.95	0.97	1.52	6.97
NTAP	22.55	1.76	3.42	4.85
ZBRA	13.15	0.78	2.50	8.66
GPN	18.65	1.96	2.10	4.68
PNW	10.53	1.12	1.98	9.13
IBM	286.38	4.15	4.38	1.44
PG	343.45	6.45	4.04	0.29
TSCO	28.76	3.57	1.10	3.38
EL	65.71	2.49	4.02	-1.11
APTV	36.97	3.31	1.94	0.80
CAH	37.47	0.64	0.13	7.67
ENPH	33.31	5.61	12.18	-0.50
GEHC	89.86	1.01	4.19	2.52
TAP	18.59	4.39	0.94	0.80
CTVA	41.97	6.68	2.48	-1.39
FTV	46.85	2.18	5.13	2.67
PSX	66.58	3.39	0.59	5.81
STLD	24.63	2.38	0.97	2.18
VLTO	32.44	1.54	3.93	5.10
CAT	79.89	3.47	1.67	-4.74
PPG	29.79	3.38	1.64	-0.68
LYV	37.79	4.34	1.99	13.09
KEYS	39.96	0.57	10.84	-0.63
NUE	19.24	7.70	0.68	-6.90
STZ	39.02	1.76	2.00	-1.24
CHTR	71.18	0.68	1.95	0.18
DOW	29.76	11.77	0.91	-5.15
DE	115.83	1.53	1.70	-2.95
CTLT	19.99	0.77	3.69	6.30
AES	14.64	6.31	1.66	2.42
MKC	19.51	2.44	2.94	1.70
IP	11.91	4.21	0.64	4.55
ALB	10.81	1.80	2.17	-31.55
CFG	18.70	10.10	1.85	1.45
SWKS	9.16	3.07	1.77	-7.48
CPB	12.89	6.18	1.02	-1.33
KEY	22.08	15.25	2.56	-0.55
NTRS	24.76	4.47	3.25	-3.06
DRI	14.54	1.24	0.93	-0.31
AOS	15.04	2.64	3.24	1.48
BBY	25.09	5.52	0.45	3.59
BALL	18.81	4.88	1.21	0.07
LYB	25.73	5.31	0.54	-2.39
BG	18.62	4.81	0.78	-3.06
WBA	4.17	42.51	0.13	-0.41
CHRW	15.16	2.63	0.78	-8.30
MOS	20.18	2.03	1.64	-33.45
ZION	7.37	9.25	1.50	-6.95
BBWI	6.32	5.60	0.57	-2.15
PNR	12.62	1.50	1.52	2.36
NDSN	11.12	0.51	3.19	0.96
BXP	7.40	1.74	3.53	4.45
HII	5.81	0.43	0.76	10.88
GNRC	9.99	0.79	2.25	-12.98
IFF	11.48	2.63	1.66	-1.26
RL	8.71	1.60	1.39	-1.10
CMA	11.46	3.55	1.65	-5.95
HAS	7.68	1.39	2.14	-19.08
VTRS	4.19	26.15	0.88	-6.77
UDR	8.62	2.80	10.65	4.43
VFC	5.28	11.68	0.66	-13.02
ETSY	6.01	3.73	2.84	1.80
WHR	7.90	0.88	0.48	-6.82
NI	7.66	6.10	1.12	1.43
FRT	6.91	0.61	9.29	6.76
ESS	12.50	0.48	15.61	8.57
LDOS	9.90	0.85	0.85	7.14
SNA	15.39	0.79	1.93	2.03
IPG	5.90	3.09	0.71	-2.44
AIZ	8.96	0.38	1.56	6.05
WBD	16.70	19.32	0.43	-1.52
J	4.32	0.68	0.50	-5.74
CZR	10.61	6.37	1.30	5.86
CPT	9.04	1.36	10.08	7.49
RHI	8.08	0.88	1.34	-0.98
ATO	12.58	0.96	2.62	3.55
SWK	8.57	1.79	1.00	-6.65
JNPR	10.62	4.15	2.35	4.77
JKHY	7.78	0.63	3.91	4.08
PH	52.06	0.78	3.91	6.50
LKQ	10.10	1.28	0.50	-8.21
STE	21.29	0.47	4.52	8.08
MKTX	7.88	0.12	10.24	12.02
PKG	13.31	1.45	1.15	-4.18
TYL	13.10	0.29	9.93	9.43
REV	4.81	1.04	0.77	0.89
AVY	13.24	0.73	1.42	-4.88
WTW	32.86	0.42	5.51	5.50
TECH	9.13	0.26	3.09	4.03
UNP	129.08	3.52	4.89	0.29
CPAY	14.54	0.95	6.41	9.17
MAS	15.65	3.40	1.03	-1.96
AEE	20.80	0.94	2.15	4.01
LNT	13.51	0.83	4.32	5.54
POOL	13.71	0.46	4.29	4.23
NXPI	54.84	2.61	8.82	-4.09
ES	18.63	1.18	3.01	3.66
EQIX	101.24	0.62	17.43	6.48
WAB	18.52	1.63	2.05	5.42
NSC	68.69	2.36	3.32	-2.28
HOLX	16.68	0.56	5.73	6.05
CMS	17.01	0.86	2.13	5.65
CNP	18.51	1.25	1.93	2.71
FDS	13.29	0.24	8.92	9.48
DLR	52.77	0.57	15.05	4.16
AVB	23.22	0.30	21.26	4.76
CE	21.00	0.74	1.64	8.82
HUBB	21.97	0.35	3.11	2.40
AEP	42.66	1.69	1.88	2.57
WY	22.11	2.74	3.43	2.95
ILMN	15.49	1.05	4.33	-6.62
GWW	20.80	0.56	2.15	2.95
EQR	28.70	0.37	18.39	5.21
TFC	47.08	5.55	2.71	-1.41
ED	25.96	0.99	1.87	3.59
BR	18.93	0.40	3.23	3.10
PAYC	11.96	0.57	13.12	17.52
RJF	22.89	0.68	2.27	12.54
VMC	32.22	1.03	5.35	-0.99
HBAN	22.90	27.15	5.00	0.00
ALGN	13.57	0.62	4.93	-7.79
PEAK	9.29	0.31	2.53	-5.28
JBHT	25.73	0.50	1.66	2.69
PKI	23.50	0.27	9.31	0.21
WEC	29.70	0.73	2.61	3.37
ULTA	13.77	2.26	2.37	3.57
ODFL	23.25	0.46	4.70	0.79
TTWO	42.80	5.79	6.88	5.31
MLM	25.80	0.52	4.85	-3.38
SBAC	41.42	0.35	14.16	2.63
UAA	6.92	2.11	0.93	-1.84
ANSS	23.91	0.23	11.73	10.72
K	22.99	5.75	1.77	-0.74
AJG	37.87	0.73	6.36	11.12
VRSN	16.01	0.49	13.00	6.98
CFR	17.33	1.04	5.67	2.01
XEL	33.50	1.02	2.31	3.59
AMTM	14.85	0.29	15.05	3.72
WST	20.60	0.35	6.66	7.19
GL	16.09	0.25	2.86	10.16
CDAY	7.85	0.75	8.41	6.42
MTDR	11.16	0.72	1.28	24.53
HSY	33.74	2.29	3.43	2.52
DOV	23.23	0.53	3.42	2.01
UA	6.41	3.07	0.93	-1.84
LW	21.88	0.37	3.80	8.33
CCI	38.30	0.57	13.00	-1.00
DPZ	12.01	0.83	2.26	5.68
IEX	12.66	0.56	3.24	4.30
DTE	28.00	1.04	1.78	2.38
EXAS	7.60	1.59	5.33	13.65
PHM	15.70	2.65	0.92	3.89
SJM	12.97	3.12	1.72	-2.61
GPC	15.99	1.97	1.20	-0.72
ALLE	13.99	0.64	2.38	4.48
TDY	21.47	0.15	4.39	2.92
BLDR	26.91	0.49	2.35	6.54
TRMB	13.51	0.70	3.51	-2.93
CHRW	15.16	2.63	0.78	-8.30
SUI	9.49	0.16	11.91	5.85
FMC	9.96	2.07	1.60	-14.20
TYL	13.10	0.29	9.93	9.43
LII	18.62	0.44	4.01	1.91
VNO	8.14	0.51	6.53	-0.08
RBC	24.67	0.20	3.24	7.80
NCLH	8.68	25.55	0.90	10.87
MOG.A	16.39	0.55	2.14	0.00
PWR	12.73	0.29	3.51	6.67
LAMR	9.59	0.11	8.62	5.39
PAYC	11.96	0.57	13.12	17.52
PEN	9.42	1.03	2.58	-2.68
WRK	11.14	2.79	0.84	-11.35
IT	19.06	0.57	3.13	-0.94
EXR	28.27	0.87	8.57	27.64
FBHS	9.38	0.85	1.21	-4.17
JBHT	25.73	0.50	1.66	2.69
AES	14.64	6.31	1.66	2.42
MAA	15.15	0.24	13.95	4.92
OMI	17.12	0.39	3.46	5.11
SEE	6.41	2.31	0.86	-0.24
RGA	14.27	0.31	1.80	6.41
LDOS	9.90	0.85	0.85	7.14
SNV	7.98	6.31	1.98	-5.84
FITB	28.34	9.14	2.21	5.62
PNW	10.53	1.12	1.98	9.13
NTRS	24.76	4.47	3.25	-3.06
CRL	9.12	0.25	2.02	-2.98
OGN	9.89	2.47	1.24	-8.41
SLG	3.96	0.67	8.16	7.81
WELL	130.57	3.31	13.31	21.23
GNRC	9.99	0.79	2.25	-12.98
HWM	83.18	2.28	10.43	11.90
PNR	12.62	1.50	1.52	2.36
BBWI	6.32	5.60	0.57	-2.15
EVRG	17.40	2.75	2.96	6.16
VICI	32.43	8.66	8.15	6.57
BXP	7.40	1.74	3.53	4.45`;

function dbRun(db, sql, params = []) {
  return new Promise((resolve, reject) => {
    db.run(sql, params, function(err) {
      if (err) reject(err);
      else resolve(this);
    });
  });
}

async function main() {
  const db = new sqlite3.Database(DB_PATH);

  console.log('=' * 60);
  console.log('POPULATING YEAR 0 FROM FRONTEND DATA');
  console.log('='.repeat(60));
  console.log('');

  try {
    // Parse the frontend data
    const lines = frontendData.trim().split('\n');
    const records = lines.map(line => {
      const parts = line.split('\t');
      return {
        symbol: parts[0],
        marketCap: parseFloat(parts[1]) * 1000000000, // Convert billions to actual value
        adtv: parseFloat(parts[2]) * 1000000, // Convert millions to actual value
        priceToSales: parseFloat(parts[3]),
        salesGrowth: parseFloat(parts[4])
      };
    });

    console.log(`Parsed ${records.length} records from frontend data\n`);

    let updated = 0;
    let failed = 0;
    let notFound = 0;

    for (const record of records) {
      const { symbol, marketCap, adtv, priceToSales, salesGrowth } = record;

      try {
        // Update the database
        const result = await dbRun(db, `
          UPDATE historical_fundamentals
          SET marketCap = ?,
              adtv = ?,
              priceToSales = ?,
              salesGrowth = ?
          WHERE symbol = ? AND yearsAgo = 0
        `, [marketCap, adtv, priceToSales, salesGrowth, symbol]);

        if (result.changes > 0) {
          updated++;
          if (updated % 50 === 0) {
            console.log(`Progress: ${updated}/${records.length} records updated`);
          }
        } else {
          notFound++;
          console.log(`  ⚠ ${symbol}: No Year 0 record found in database`);
        }
      } catch (error) {
        failed++;
        console.error(`  ✗ ${symbol}: ${error.message}`);
      }
    }

    console.log('\n' + '='.repeat(60));
    console.log('YEAR 0 POPULATION COMPLETE');
    console.log('='.repeat(60));
    console.log(`✓ Updated: ${updated}`);
    console.log(`⚠ Not found: ${notFound}`);
    console.log(`✗ Failed: ${failed}`);
    console.log(`Total processed: ${records.length}`);

  } catch (error) {
    console.error('\n✗ Fatal error:', error);
    process.exit(1);
  } finally {
    db.close();
  }
}

main();
